<%# stats = local_assigns[:stats] || @stats_page || [] %>
<%# pagy = local_assigns[:pagy] || @pagy %>
<div class="table-responsive">
<table class="table table-striped table-sm table-hover align-middle"
  style="font-size:14px; table-layout:fixed; width:100%;">
  <thead class="table-light">
    <tr>
      <th style="width:1%"></th>
      <th>Сотрудник</th>
      <th>Подразделение</th>
      <th class="text-end">Дней</th>
      <th class="text-end">Часы</th>
      <th class="text-end">Переработка</th>
      <th class="text-end">Недоработка</th>
    </tr>
  </thead>
  <tbody data-controller="reorder" data-reorder-input-value="#wt_order">
    <% stats.each do |r| %>
      <% u = r[:user] %>
      <% days = r[:days].to_i %>
      <% hours = r[:hours].to_f.round(2) %>
      <% base = (days * 8.0).round(2) %>
      <% delta = (hours - base).round(2) %>
      <% overtime  = delta.positive? ? delta : 0.0 %>
      <% undertime = delta.negative? ? -delta : 0.0 %>
      <tr data-user-id="<%= u.id %>">
        <td class="text-muted text-center pe-0">
          <span class="drag-handle">⋮⋮</span>
        </td>
        <td class="nowrap"><%= "#{u.last_name} #{u.first_name}" %></td>
        <td><%= u.current_division&.name || "—" %></td>
        <td class="text-end"><%= days %></td>
        <td class="text-end fw-semibold"><%= number_with_precision(hours, precision: 2) %></td>
        <td class="text-end">
          <% if overtime > 0 %>
            <span class="badge bg-success-subtle text-success"><%= number_with_precision(overtime, precision: 2) %></span>
          <% else %>—<% end %>
        </td>
        <td class="text-end">
          <% if undertime > 0 %>
            <span class="badge bg-danger-subtle text-danger"><%= number_with_precision(undertime, precision: 2) %></span>
          <% else %>—<% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if defined?(pagy) && pagy %>
  <div class="d-flex justify-content-end">
    <%= raw pagy_bootstrap_nav(pagy) %>
  </div>
<% end %>
</div>