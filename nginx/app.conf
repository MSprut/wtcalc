# Nginx server for a single FQDN and changeable upstream IP/port.
# Set SERVER_NAME to your subdomain (e.g., wtcalc.example.com).
# Set UPSTREAM_HOST to an IP (or hostname) and UPSTREAM_PORT to app port.

server {
  listen 80;
  server_name wtcalc.example.com;  # поменяй на свой домен/сабдомен

  access_log /var/log/nginx/app_access.log;
  error_log  /var/log/nginx/app_error.log;

  location / {
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_read_timeout 300;
    proxy_pass http://web:3000;    # либо http://<IP>:3000 если хочешь по IP
  }
}


# server {
#   listen 80;
#   server_name app.localhost;

#   # Логи (удобно в отладке)
#   access_log /var/log/nginx/app_access.log;
#   error_log  /var/log/nginx/app_error.log;

#   # Простая health-страница, проксируемая на Rails /up (или /)
#   location = /health {
#     proxy_set_header Host $host;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_pass http://web:3000;
#   }

#   location / {
#     proxy_http_version 1.1;
#     proxy_set_header Connection "";
#     proxy_set_header Host $host;
#     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#     proxy_set_header X-Forwarded-Proto $scheme;
#     proxy_read_timeout 300;
#     proxy_pass http://web:3000;
#   }
# }